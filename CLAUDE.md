# プロジェクト固有ルール

## 基本方針

- **回答言語**: 日本語で回答すること
- **思考言語**: 内部的な思考は英語で行い、出力は日本語
- **コード内コメント**: 日本語または英語（プロジェクトの既存コードに合わせる）

---

## コミットメッセージ規約

### フォーマット

```
<type>: <subject>

<body>（任意）

<footer>（任意）
```

### Type（種別）

| Type | 説明 |
|------|------|
| `feat` | 新機能の追加 |
| `fix` | バグ修正 |
| `docs` | ドキュメントのみの変更 |
| `style` | コードの意味に影響しない変更（空白、フォーマット等） |
| `refactor` | バグ修正でも機能追加でもないコード変更 |
| `perf` | パフォーマンス改善 |
| `test` | テストの追加・修正 |
| `chore` | ビルドプロセスや補助ツールの変更 |

### 記述ルール

- **Subject（件名）**: 日本語で簡潔に記述（50文字以内推奨）
- **Body（本文）**: 変更の理由や背景を日本語で説明
- **命令形を避ける**: 「〜を追加」「〜を修正」のように体言止めまたは過去形で記述

### 例

```
feat: ユーザー認証機能を追加

JWT を使用したトークンベース認証を実装。
セッション管理よりもスケーラビリティを優先した設計。
```

```
fix: ログイン時のバリデーションエラーを修正

空文字列が渡された場合に例外が発生する問題を解決。
```

---

## コードスタイル

### 全般

- **Linter/Formatter**: プロジェクトで設定された Linter・Formatter に必ず準拠
- **一貫性**: 既存コードのスタイルに合わせる
- **命名規則**: 言語・フレームワークの慣例に従う
  - JavaScript/TypeScript: camelCase（変数・関数）、PascalCase（クラス・コンポーネント）
  - Python: snake_case（変数・関数）、PascalCase（クラス）

### コメント

- **Why を説明**: 「何をしているか」ではなく「なぜそうしているか」を記述
- **自明なコメントは避ける**: コードを読めば分かることは書かない
- **TODO/FIXME**: 必ず Issue 番号または担当者を記載
  ```javascript
  // TODO(#123): キャッシュ機構の実装
  // FIXME(@username): 一時的な回避策、本番前に修正必要
  ```

### ドキュメント

- 関数・クラスには目的と使用方法を記述
- 複雑なロジックにはインラインコメントで補足
- README は常に最新状態を維持

---

## 品質基準

### コード品質

| 観点 | 指針 |
|------|------|
| **冗長性の排除** | DRY 原則を遵守、重複コードは共通化 |
| **シンプルさ** | KISS 原則、過度な抽象化を避ける |
| **必要最小限** | YAGNI 原則、将来の仮定で機能を追加しない |
| **単一責任** | 1つの関数・クラスは1つの責務のみ |
| **可読性** | 他者が読んで理解できるコードを書く |

### セキュリティ

- **機密情報**: API キー、パスワードは環境変数で管理（ハードコード禁止）
- **入力検証**: 外部からの入力は必ずバリデーション
- **依存関係**: 定期的にセキュリティ監査を実施
- **最小権限**: 必要最小限の権限で動作させる
- **OWASP Top 10**: 主要な脆弱性パターンを意識

### エラーハンドリング

- 例外を握りつぶさない（catch で何もしない禁止）
- 適切なエラーメッセージを提供
- 外部 API・ネットワーク通信は失敗前提で設計
- リトライ機構は指数バックオフを検討

---

## テスト

- テストをスキップ・無効化しない
- 実装詳細ではなく振る舞いをテスト
- テスト間の依存を避け、独立して実行可能に
- エッジケースとエラーケースを網羅
- カバレッジは指標であり、質を重視

---

## 技術スタック別ベストプラクティス

<!-- プロジェクトで使用する技術を追加してください -->

### JavaScript / TypeScript

- 厳格な型定義を使用（`any` は原則禁止）
- `async/await` を優先（コールバック地獄を避ける）
- Optional Chaining・Nullish Coalescing を活用
- ES Modules を使用

### React（使用する場合）

- 関数コンポーネント + Hooks を基本とする
- コンポーネントは小さく保つ
- Props の型定義を必ず行う
- 不要な再レンダリングを避ける（`useMemo`、`useCallback` の適切な使用）

### Python（使用する場合）

- 型ヒントを積極的に使用
- `black` / `ruff` でフォーマット統一
- 仮想環境を使用（`venv`、`poetry`、`uv` 等）
- `requirements.txt` または `pyproject.toml` で依存関係を管理

### Node.js（使用する場合）

- `package-lock.json` をコミット
- 環境変数は `.env` + `dotenv` で管理
- 非同期処理は Promise / async-await で統一

---

## Git 運用

- **ブランチ戦略**: feature ブランチで作業、main への直接コミット禁止
- **コミット粒度**: 1つの論理的な変更 = 1コミット
- **変更前確認**: `git diff` で差分を確認してからコミット
- **危険操作禁止**: `--force` push、`--hard` reset は原則禁止

---

## 禁止事項

- [ ] `@ts-ignore` / `# type: ignore` の安易な使用
- [ ] `console.log` のコミット（デバッグ用は削除）
- [ ] TODO コメントを残したままの機能実装
- [ ] テストなしでの本番コード変更
- [ ] 未使用のコード・import の放置

---

## ファイル構成

```
project-root/
├── CLAUDE.md          # このファイル
├── README.md          # プロジェクト概要
├── src/               # ソースコード
├── tests/             # テストコード
├── docs/              # ドキュメント
└── scripts/           # ユーティリティスクリプト
```

---

## 参考リンク

- [Conventional Commits](https://www.conventionalcommits.org/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [The Twelve-Factor App](https://12factor.net/ja/)
